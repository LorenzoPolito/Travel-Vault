---
const base = import.meta.env.BASE_URL;
---

<div id="search" class="search-container"></div>

<script is:inline define:vars={{ base }}>
  document.addEventListener('astro:page-load', () => {
    if (document.querySelector('#search .pagefind-ui')) return;
    
    // @ts-ignore
    new PagefindUI({
      element: "#search",
      baseUrl: base,
      bundlePath: `${base}/_pagefind/`,
      showSubResults: true,
      translations: {
        placeholder: "Cerca destinazioni, luoghi, itinerari...",
        clear_search: "Cancella",
        load_more: "Carica altri",
        search_label: "Cerca",
        filters_label: "Filtri",
        zero_results: "Nessun risultato per [SEARCH_TERM]",
        many_results: "[COUNT] risultati per [SEARCH_TERM]",
        one_result: "[COUNT] risultato per [SEARCH_TERM]",
        alt_search: "Nessun risultato per [SEARCH_TERM]. Mostrando risultati per [VISUAL_TERM] invece.",
        search_suggestion: "Nessun risultato per [SEARCH_TERM]. Prova una di queste ricerche:",
        searching: "Ricerca in corso..."
      }
    });
  });
</script>

<style>
  .search-container {
    --pagefind-ui-primary: var(--accent);
    --pagefind-ui-text: var(--text-main);
    --pagefind-ui-background: var(--bg-card);
    --pagefind-ui-border: var(--glass-border);
    --pagefind-ui-tag: var(--accent);
    --pagefind-ui-border-radius: var(--radius-md);
    --pagefind-ui-font: inherit;
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
  }

  :global(.pagefind-ui__drawer) {
    background: var(--bg-card) !important;
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-top: none;
    border-radius: 0 0 var(--radius-md) var(--radius-md);
  }

  :global(.pagefind-ui__result) {
    border-bottom: 1px solid var(--glass-border) !important;
  }
  
  :global(.pagefind-ui__search-input) {
    background: var(--bg-card) !important;
    color: var(--text-main) !important;
  }
</style>
