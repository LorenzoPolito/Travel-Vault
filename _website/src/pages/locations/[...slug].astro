---
import { getCollection, render } from 'astro:content';
import Base from '../../layouts/Base.astro';
import Map from '../../components/Map.astro';

export async function getStaticPaths() {
  const entries = await getCollection('locations');
  return entries.map(entry => ({
    params: { slug: entry.id.replace(/\.md$/, '') },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
const base = import.meta.env.BASE_URL;

const displayName = entry.id.split('/').pop()?.replace(/-/g, ' ').replace(/\.md$/, '').replace(/\b\w/g, (l: string) => l.toUpperCase()) || entry.id;
const typeEmoji = entry.data.type === 'city' ? 'ğŸ™ï¸' :
                  entry.data.category?.toLowerCase().includes('templ') ? 'â›©ï¸' :
                  entry.data.category?.toLowerCase().includes('park') ? 'ğŸŒ³' :
                  entry.data.category?.toLowerCase().includes('build') ? 'ğŸ¢' :
                  entry.data.category?.toLowerCase().includes('store') ? 'ğŸ›ï¸' :
                  entry.data.category?.toLowerCase().includes('castle') ? 'ğŸ¯' :
                  entry.data.type === 'quartiere' ? 'ğŸ˜ï¸' :
                  entry.data.type === 'street' ? 'ğŸ›¤ï¸' : 'ğŸ“';
---

<Base title={displayName} description={`${displayName} â€” ${entry.data.destination || ''}`}>
  <section class="section">
    <div class="content-container">
      <div class="breadcrumbs">
        <a href={`${base}/`}>Home</a>
        <span class="separator">/</span>
        <a href={`${base}/destinations/`}>Destinazioni</a>
        {entry.data.destination && (
          <>
            <span class="separator">/</span>
            <a href={`${base}/destinations/${entry.data.destination.toLowerCase()}/`}>{entry.data.destination}</a>
          </>
        )}
        <span class="separator">/</span>
        <span>{displayName}</span>
      </div>

      <div class="page-header">
        <h1 class="page-title">{displayName}</h1>
        <div class="page-meta">
          {entry.data.type && <span class="tag">{entry.data.type}</span>}
          {entry.data.category && <span class="tag tag--info">{entry.data.category}</span>}
          {entry.data.city && <span class="tag tag--success">{entry.data.city}</span>}
          {entry.data.rating && <span class="rating">â­ {entry.data.rating}</span>}
        </div>
      </div>

      {entry.data.location && Array.isArray(entry.data.location) && (
        <Map 
          lat={entry.data.location[0]} 
          lon={entry.data.location[1]} 
          zoom={15} 
          height="300px" 
        />
      )}

      <div class="content">
        <Content />
      </div>
    </div>
  </section>
</Base>
